<link rel="import" href="../polymer/polymer-element.html">

<dom-module id="card-hello-world-composer">
  <template>
    <style>
    </style>
    <div>
      <!-- Replace this with your composer markup that lets the user who is going to post a card
      populate its contents -->
      <div id="contents" contentEditable placeholder="Enter card contents" on-input="_onContentChanged"></div>
    </div>
  </template>
  <script>
    class CardHelloWorldComposer extends Polymer.Element {
      static get is() { return 'card-hello-world-composer'; }
      static get properties() {
        return {
          // Following populated by container
          services: Object,             // .upload(file) => Promise<String>
          author: Object,               // .imageUrl, .handle, .name
          // Following populated by this composer and available to container
          ready: Boolean,
          recommendedImageUrl: String,
          recommendedTitle: String,
          recommendedText: String,
          recommendedLinkUrl: String
        };
      }
      getSharedState() {
        // Replace this with the appropriate code to return the state information that will be passed to the
        // viewer when the card is opened
        return {
          properties: {
            content: this.$.contents.textContent
          },
          collections: {}
        };
      }
      _onContentChanged() {
        const isReady = this.$.contents.textContent.trim().length > 0;
        this.dispatchEvent(new CustomEvent('shared-state-changed', { bubbles: true, composed: true, detail: {} }));
        if (isReady !== this.ready) {
          this.set('ready', isReady);
          this.set('recommendedTitle', "Hello World");
          this.set('recommendedText', this.$.contents.textContent);
          this.dispatchEvent(new CustomEvent('ready-changed', { bubbles: true, composed: true, detail: { ready: this.ready } }));
        }
      }
    }
    window.customElements.define(CardHelloWorldComposer.is, CardHelloWorldComposer);
  </script>
</dom-module>

<dom-module id="card-hello-world-viewer">
  <template>
    <div>
      <div>[[sharedState.properties.content]]</div>
    </div>
  </template>
  <script>
    class CardHelloWorldViewer extends Polymer.Element {
      static get is() { return 'card-hello-world-viewer'; }
      static get properties() {
        return {
          // Following are populated by the container
          sharedState: Object,    // .properties .collections
          author: Object,         // .handle, .name, .imageUrl
          user: Object            // .handle, .name, .imageUrl
        };
      }
    }
    window.customElements.define(CardHelloWorldViewer.is, CardHelloWorldViewer);
  </script>
</dom-module>
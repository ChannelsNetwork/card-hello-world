<link rel="import" href="../polymer/polymer-element.html">

<dom-module id="card-hello-world-composer">
  <template>
    <style>
      .container {
        width: 100%;
        max-width: 600px;
        margin: 0 auto;
        box-sizing: border-box;
      }

      #contents {
        background-color: white;
        text-align: left;
        width: 100%;
        font-size: 16px;
        border: 0;
        outline: 0;
      }
    </style>
    <div class="container">
      <!-- Replace this with your composer markup that lets the user who is going to post a card
      populate its contents -->
      <input type="text" placeholder="Enter your card text here" id="contents" on-input="_onContentChanged">
    </div>
  </template>
  <script>
    class CardHelloWorldComposer extends Polymer.Element {
      static get is() { return 'card-hello-world-composer'; }
      static get properties() {
        return {
          // Following populated by container
          services: Object,             // .upload(file) => Promise<String>
          author: Object,               // .imageUrl, .handle, .name
          // Following populated by this composer and available to container
          ready: Boolean,
          recommendedImageUrl: String,
          recommendedTitle: String,
          recommendedText: String,
          recommendedLinkUrl: String
        };
      }
      connectedCallback() {
        super.connectedCallback();
        this.set('recommendedTitle', "Hello World");
        this.set('recommendedImageUrl', "https://goo.gl/images/9K9Tr3");
      }
      getSharedState() {
        // Replace this with the appropriate code to return the state information that will be passed to the
        // viewer when the card is opened
        return {
          properties: {
            content: this.$.contents.value
          },
          collections: {}
        };
      }
      _onContentChanged() {
        this.set('recommendedText', this.$.contents.value);
        this.dispatchEvent(new CustomEvent('shared-state-changed', { bubbles: true, composed: true, detail: {} }));
        const isReady = this.$.contents.value.trim().length > 0;
        if (isReady !== this.ready) {
          this.set('ready', isReady);
          this.dispatchEvent(new CustomEvent('ready-changed', { bubbles: true, composed: true, detail: { ready: this.ready } }));
        }
      }
    }
    window.customElements.define(CardHelloWorldComposer.is, CardHelloWorldComposer);
  </script>
</dom-module>

<dom-module id="card-hello-world-viewer">
  <template>
    <div>
      <div>[[sharedState.properties.content]]</div>
    </div>
  </template>
  <script>
    class CardHelloWorldViewer extends Polymer.Element {
      static get is() { return 'card-hello-world-viewer'; }
      static get properties() {
        return {
          // Following are populated by the container
          sharedState: Object,    // .properties .collections
          author: Object,         // .handle, .name, .imageUrl
          user: Object            // .handle, .name, .imageUrl
        };
      }
    }
    window.customElements.define(CardHelloWorldViewer.is, CardHelloWorldViewer);
  </script>
</dom-module>